= JWT Validation Performance Analysis
:toc: left
:toclevels: 2

== Executive Summary

Performance testing using WRK with stress profile (10 threads, 300 connections) shows:

* **JWT Validation**: 14,173 ops/s
* **Health Check**: 26,776 ops/s
* **CPU Utilization**: 74.9% average
* **Target Achievement**: 28% of minimum target (50k ops/s)

== WRK Stress Profile Results

=== Configuration

* **Tool**: WRK (native C HTTP benchmarking tool)
* **Profile**: Stress (10 threads, 300 connections)
* **Duration**: 3 minutes per benchmark
* **Environment**: 10 CPU cores, Docker with auto-scaling
* **Application**: Native Quarkus with virtual threads

=== Performance Results

[cols="2,2,2,2", options="header"]
|===
|Endpoint
|Throughput
|P99 Latency
|CPU Usage

|JWT Validation
|14,173 ops/s
|583.6ms
|74.9%

|Health Check
|26,776 ops/s
|579.9ms
|74.9%
|===

=== Resource Utilization

* **CPU**: 74.9% average, 80.9% peak
* **Memory**: 99MB heap (127MB peak)
* **Threads**: 119 concurrent threads
* **GC**: Zero overhead (native compilation)

== Performance Analysis

=== Bottleneck Identification

1. **CPU not saturated** (only 74.9% utilization)
2. **Connection pool management overhead**
3. **JWKS resolution and caching overhead**
4. **Virtual threads handling 119 concurrent threads efficiently**

=== Performance Ceiling

* **Achieved**: 14,173 ops/s
* **Theoretical limit**: ~20k ops/s (if CPU reached 100%)
* **HTTP stack limit**: 26,776 ops/s (health check baseline)

== Implications for Issue #113

The target of 50-100k ops/s is **architecturally impossible** with current design:

* Current achievement: 14,173 ops/s (28% of minimum target)
* Gap to target: 35,827 ops/s minimum
* Required improvement: 250-600% increase

=== Required Changes for 50k+ ops/s

1. **Embedded JWKS keys** - Eliminate Keycloak network calls
2. **Async/reactive architecture** - Full non-blocking I/O
3. **Protocol optimization** - Consider gRPC instead of HTTP/REST
4. **Horizontal scaling** - Multiple instances with load balancing

== Conclusion

WRK stress testing reveals a performance ceiling of approximately 14k ops/s for JWT validation, limited not by CPU but by architectural constraints. The health check baseline of 27k ops/s demonstrates the HTTP stack can handle higher throughput, but JWT validation adds significant overhead.

The 50-100k ops/s target requires fundamental architectural changes beyond optimization of the current implementation.