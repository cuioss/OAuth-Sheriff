= Resource Utilization Comparison Analysis - September 2025
:source-highlighter: highlight.js

Analysis of actual CPU and RAM resource consumption by the three key components during benchmark execution: Quarkus system under test, WRK load driver, and JMH benchmark runner.

== Overview

This analysis compares the actual resource utilization (CPU and RAM) of:

1. **Quarkus System Under Test** - The target JWT validation application
2. **WRK Load Driver** - The HTTP load generation tool
3. **JMH Benchmark Runner** - The microbenchmark execution environment

== Resource Utilization Data

=== Quarkus System Under Test (from /metrics endpoint)

**CPU Usage During Different Benchmarks:**

.JMH Integration Benchmarks (benchmark-integration-quarkus)
- Process CPU Usage: **40.74%** (process_cpu_usage 0.40740279833176374)
- System CPU Usage: **41%** (from metrics JSON)
- Available CPUs: **4 cores** (system_cpu_count 4.0)
- Source: `/benchmarking/benchmark-integration-quarkus/target/metrics-download/quarkus-metrics.txt`

.WRK Load Testing (benchmark-integration-wrk)
- Process CPU Usage: **NOT COLLECTED** (metrics download not implemented)
- System CPU Usage: **NOT COLLECTED** (metrics download not implemented)
- Available CPUs: **4 cores** (assumed)
- **CRITICAL GAP**: WRK benchmarks do not download Quarkus metrics, only system-wide data available

**Memory Usage:**
- Heap Memory Used: **17.3 MB** (7,864,320 + 9,437,184 bytes)
  - Old Generation: 7.86 MB
  - Eden Space: 9.44 MB
  - Survivor Space: 0 MB
- Heap Memory Committed: **17.3 MB** (same as used - fully utilized)
- Non-Heap Memory: **0 MB** (runtime code cache unused in native image)

**Validation Performance:**
- JWT Validations: **5,864,975 operations**
- Validation Latency P50: **237 microseconds**
- Validation Latency P99: **6.969 milliseconds**

=== System-Wide Metrics (from system monitoring during WRK runs)

**Total System Load:**
- CPU Usage: **242.8% - 756.8%** (multi-core utilization)
- Memory Usage: **17-81 MB**
- Process Count: **884-898 processes**
- Load Average: **6.60 - 8.71**

=== JMH Benchmark Runner Performance

**Throughput Results:**
- Health Check: **10,238 ops/sec** (1,134,061 samples)
- JWT Validation: **7,841 ops/sec** (826,126 samples)

**Latency Results:**
- Health Check P50: **1.901 ms**, P99: **5.210 ms**
- JWT Validation P50: **2.621 ms**, P99: **7.430 ms**

=== WRK Load Driver Performance

**HTTP Load Generation:**
- JWT Endpoint: **8,247 req/sec** with 5.62ms average latency
- Health Endpoint: **14,617 req/sec** with 0.83ms average latency
- Test Configuration: 4 threads, 20 connections, 30-second duration

== Resource Consumption Analysis

=== CPU Utilization Comparison

.JMH Integration Benchmarks
|===
|Component |CPU Usage |Notes

|**Quarkus System**
|**40.74%**
|Moderate usage during JMH benchmarks

|**JMH Runner + Overhead**
|~**60-200%**
|JMH framework and OS overhead
|===

.WRK Load Testing Benchmarks
|===
|Component |CPU Usage |Notes

|**Quarkus System**
|**UNKNOWN**
|Metrics not collected during WRK benchmarks

|**System Total**
|**242-756%**
|Includes Quarkus + WRK + OS overhead

|**WRK Load Driver Impact**
|**Cannot Calculate**
|Missing Quarkus-specific metrics
|===

**Key Finding**:
- **JMH benchmarks**: ~41% CPU with proper metrics collection
- **WRK benchmarks**: Missing Quarkus metrics - only total system CPU available
- **Critical Gap**: WRK benchmarks need metrics download implementation to enable proper resource comparison

=== Memory Utilization Comparison

|===
|Component |RAM Usage |Efficiency

|**Quarkus System**
|**17.3 MB**
|Extremely efficient native image

|**System Total**
|**17-81 MB**
|Includes all processes

|**Load Driver Impact**
|~**0-64 MB**
|WRK + JMH memory overhead varies
|===

**Key Finding**: The Quarkus native application uses a tiny, stable 17.3 MB of memory, while the benchmarking infrastructure memory usage fluctuates significantly (0-64 MB additional).

=== Performance Efficiency

**Quarkus System Efficiency (JMH Benchmarks):**
- **Throughput**: 7,841 ops/sec at 41% CPU
- **Memory**: 17.3 MB RAM (stable)
- **CPU per Request**: ~0.005% CPU per operation

**Quarkus System Efficiency (WRK Load Testing):**
- **Throughput**: 8,247 req/sec (from WRK output)
- **CPU Usage**: UNKNOWN (metrics not collected)
- **Memory Usage**: UNKNOWN (metrics not collected)
- **Critical Gap**: Cannot calculate efficiency without Quarkus metrics

**Load Generation Overhead:**
- **JMH**: Estimated 1.5-5x more CPU than the application (based on 41% app usage)
- **WRK**: Cannot calculate - missing Quarkus-specific metrics
- **Memory Overhead**: Cannot determine without proper metrics collection
- **Infrastructure Cost**: Testing infrastructure likely consumes significantly more resources, but cannot quantify for WRK

== Conclusions

=== Resource Utilization Findings

1. **JMH Benchmarks Show Efficiency**: Quarkus uses 41% CPU and 17.3 MB RAM for 7,841 ops/sec
2. **WRK Benchmarks Missing Critical Data**: No Quarkus-specific metrics collected, only system-wide data available
3. **Memory Footprint is Minimal**: JMH benchmarks confirm stable 17.3 MB memory usage
4. **Testing Overhead Cannot Be Fully Quantified**: JMH shows ~1.5-5x overhead, WRK unknown due to missing metrics

=== Practical Implications

- **Production Efficiency**: Quarkus JWT validation service is resource-efficient based on JMH data
- **Testing Resources**: JMH data suggests 3-5x resource overhead for testing
- **Scaling Characteristics**: Low memory footprint (17.3 MB) enables high container density
- **Incomplete Analysis**: WRK benchmarks need metrics download implementation for full comparison

=== Recommendations

1. **Implement Metrics Download for WRK**: Add Quarkus metrics collection during WRK benchmarks
   - Download metrics from `/q/metrics` endpoint before and after WRK runs
   - Store in `target/metrics-download/` similar to JMH benchmarks
   - Calculate delta values for accurate resource consumption

2. **Enhance System Monitoring**: Current system metrics don't distinguish between processes
   - Consider per-process CPU/memory tracking
   - Separate Quarkus, WRK, and system overhead measurements

3. **Unified Metrics Format**: Standardize metrics collection across all benchmark types
   - Use consistent JSON format for both JMH and WRK benchmarks
   - Enable direct comparison of resource utilization