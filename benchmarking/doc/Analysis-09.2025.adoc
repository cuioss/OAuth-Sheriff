= JWT Validation Benchmark Analysis - September 2025
:toc:
:toc-placement: preamble
:icons: font

== Executive Summary

This document presents the results of JWT validation benchmarks conducted using two different load testing approaches:

1. **WRK Benchmark**: HTTP-based load testing with WRK (Web Request Kit)
2. **Quarkus JMH Benchmark**: Java-based micro-benchmarking with JMH

Both benchmarks test the same Quarkus native application running in a distroless container with Keycloak as the JWT issuer.

== Test Environment

* **Platform**: macOS Darwin 24.6.0 (ARM64)
* **CPU**: 4 cores available
* **Java Version**: OpenJDK 21.0.7 (Temurin)
* **Quarkus**: Native compilation with Mandrel 23.1.8.0
* **Container**: Distroless image (111MB)
* **Keycloak**: Version 26.2.5

== Benchmark Results Comparison

[cols="3,2,2", options="header"]
|===
| Metric | WRK Benchmark | Quarkus JMH Benchmark

3+^h| *System Resources*

| CPU Cores Available
| 4
| 4

| System CPU Usage
| 89%
| 38%

| Quarkus CPU Usage
| 89%
| 38%

| Memory Heap Used
| 30 MB
| 19 MB

| Peak Threads
| 57
| N/A

3+^h| *HTTP Performance*

| Total Requests
| 264,785
| 1,430,364

| Requests per Second
| 746 req/s
| 855 req/s

| Average Duration
| 1.3 ms
| 1.17 ms

| Max Duration
| 48 ms
| N/A

3+^h| *JWT Validation*

| Access Tokens Created
| 264,785
| 1,430,364

| Validation Errors
| 0
| 0

| Error Categories
| All 0
| All 0
|===

== Key Observations

=== Performance Characteristics

1. **Throughput**: The Quarkus JMH benchmark achieved higher throughput (855 req/s) compared to WRK (746 req/s), approximately 15% better performance.

2. **CPU Utilization**:
   - WRK benchmark saturated the CPU at 89%, indicating it pushed the system to its limits
   - JMH benchmark used only 38% CPU, suggesting it wasn't fully utilizing system resources

3. **Memory Usage**:
   - Both benchmarks showed efficient memory usage
   - WRK: 30 MB heap
   - JMH: 19 MB heap
   - This demonstrates excellent memory efficiency of the native Quarkus application

4. **Response Times**:
   - Very consistent sub-2ms average response times in both benchmarks
   - WRK reported max latency of 48ms (likely during warmup or GC)

=== Benchmark Methodology Differences

[cols="2,3,3", options="header"]
|===
| Aspect | WRK | JMH

| Load Generation
| External HTTP client
| In-process Java client

| Network Stack
| Full HTTP/2 over TLS
| HTTP/2 client (localhost)

| Concurrency Model
| 24 threads, 100 connections
| 24 JMH threads

| Duration
| ~6 minutes runtime
| ~28 minutes runtime

| Measurement
| End-to-end including network
| Focused on application logic
|===

== Conclusions

1. **Both benchmarks validate excellent performance**: The JWT validation service consistently handles 700-850+ requests per second with sub-2ms latency.

2. **Native compilation benefits are clear**:
   - Fast startup times (164ms for native app)
   - Low memory footprint (19-30 MB heap)
   - Predictable performance characteristics

3. **WRK provides more realistic load testing**: By testing through the full network stack and saturating CPU, WRK better simulates production conditions.

4. **JMH offers more precise measurements**: Lower resource usage during JMH testing suggests more efficient testing methodology, but may not reflect real-world network overhead.

== Recommendations

1. **For capacity planning**: Use WRK results (746 req/s at 89% CPU) as they represent full system stress
2. **For optimization**: Use JMH for micro-benchmarking specific code paths
3. **Memory is not a constraint**: With only 19-30 MB heap usage, the application can handle many concurrent instances
4. **CPU is the limiting factor**: Both benchmarks show CPU as the primary bottleneck for scaling

== Test Commands Used

.WRK Benchmark
[source,bash]
----
./mvnw clean verify -Pbenchmark -pl benchmarking/benchmark-integration-wrk
----

.Quarkus JMH Benchmark
[source,bash]
----
./mvnw clean verify -Pbenchmark -pl benchmarking/benchmark-integration-quarkus -Dskip.container.lifecycle=true
----

---
_Analysis conducted: September 24, 2025_