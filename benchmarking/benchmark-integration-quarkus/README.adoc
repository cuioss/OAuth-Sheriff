= Quarkus Integration JMH Benchmarks
:toc: left
:toclevels: 3
:source-highlighter: highlight.js

Real-world JWT validation performance testing against live Quarkus applications in containers.

== Quick Start

[source,bash]
----
# Run benchmarks with automatic container management (from project root)
./mvnw clean verify -Pbenchmark-testing -pl benchmarking/benchmark-integration-quarkus

# Quick validation run
./mvnw clean verify -Pbenchmark-testing -Djmh.iterations=1 -Djmh.threads=1 -pl benchmarking/benchmark-integration-quarkus

# With JFR profiling (local development only - not available in CI)
./mvnw clean verify -Pbenchmark-jfr -pl benchmarking/benchmark-integration-quarkus

# Force rebuild of Quarkus native container
./mvnw clean verify -Prebuild-container,benchmark-testing -pl benchmarking/benchmark-integration-quarkus
----

== Architecture

=== Benchmarks

* `JwtValidationBenchmark` - JWT validation endpoint performance
* `JwtHealthBenchmark` - Health check baseline measurements

=== Token Management

Pre-initialized `TokenRepository` with 100-token pool for realistic cache testing (~10% hit ratio).

=== Service URLs

* Quarkus: https://localhost:10443
* Keycloak: https://localhost:1443

== Configuration

=== JMH Settings

[source,bash]
----
-Djmh.iterations=5         # Measurement iterations (default: 5)
-Djmh.warmupIterations=1   # Warmup iterations (default: 1)
-Djmh.threads=24          # Concurrent threads (default: 24)
-Djmh.time=10s            # Time per iteration (default: 10s)
-Djmh.forks=2             # JVM forks (default: 2)
----

== Output

Results in `target/benchmark-results/`:

* `integration-benchmark-result.json` - JMH results
* `http-metrics.json` - HTTP performance metrics
* `integration-metrics.json` - Detailed metrics with security events
* `benchmark-run_*.log` - Complete console output

== Analysis

[source,bash]
----
# View throughput
jq '.[] | select(.mode == "thrpt") | {benchmark: .benchmark, score: .primaryMetric.score}' \
  target/benchmark-results/integration-benchmark-result.json

# View latency percentiles
jq '.[] | select(.mode == "sample") | .primaryMetric.scorePercentiles' \
  target/benchmark-results/integration-benchmark-result.json

# JFR analysis
jfr summary target/benchmark-results/jfr-recordings/benchmark.jfr
----

== Expected Performance

* Health Check: 10,000-15,000 ops/sec, <1ms median
* JWT Validation: 5,000-10,000 ops/sec, 1-3ms median

== Development

=== Adding Benchmarks

1. Extend `AbstractIntegrationBenchmark`
2. Use `@Benchmark` with appropriate `@BenchmarkMode`
3. Override `getBenchmarkName()` for metrics

=== Troubleshooting

[source,bash]
----
# Check containers
docker ps

# Verify services
curl -k https://localhost:10443/q/health
curl -k https://localhost:1443/realms/benchmark

# Review logs
tail -f target/benchmark-results/benchmark-run_*.log
----