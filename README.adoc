= cui-jwt-validation
:toc:
:toclevels: 3
:toc-title: Table of Contents
:sectnums:

== Status

=== Build & Quality
image:https://img.shields.io/github/actions/workflow/status/cuioss/cui-jwt/maven.yml?branch=main[Java CI with Maven,link=https://github.com/cuioss/cui-jwt/actions/workflows/maven.yml]
image:https://img.shields.io/github/actions/workflow/status/cuioss/cui-jwt/integration-tests.yml[Integration Tests,link=https://github.com/cuioss/cui-jwt/actions/workflows/integration-tests.yml]
image:https://img.shields.io/github/last-commit/cuioss/cui-jwt/main[Last Build,link=https://github.com/cuioss/cui-jwt/commits/main]
image:http://img.shields.io/:license-apache-blue.svg[License,link=http://www.apache.org/licenses/LICENSE-2.0.html]
image:https://img.shields.io/maven-central/v/de.cuioss.jwt/cui-jwt-parent.svg?label=Maven%20Central["Maven Central", link="https://central.sonatype.com/artifact/de.cuioss.jwt/cui-jwt-parent"]

image:https://sonarcloud.io/api/project_badges/measure?project=cuioss_cui-jwt-validation&metric=alert_status[Quality Gate Status,link=https://sonarcloud.io/summary/new_code?id=cuioss_cui-jwt-validation]
image:https://sonarcloud.io/api/project_badges/measure?project=cuioss_cui-jwt-validation&metric=ncloc[Lines of Code,link=https://sonarcloud.io/summary/new_code?id=cuioss_cui-jwt-validation]
image:https://sonarcloud.io/api/project_badges/measure?project=cuioss_cui-jwt-validation&metric=coverage[Coverage,link=https://sonarcloud.io/summary/new_code?id=cuioss_cui-jwt-validation]

=== Performance Benchmarks
image:https://img.shields.io/github/actions/workflow/status/cuioss/cui-jwt/benchmark.yml[JMH Benchmarks,link=https://github.com/cuioss/cui-jwt/actions/workflows/benchmark.yml]
image:https://img.shields.io/endpoint?url=https://cuioss.github.io/cui-jwt/benchmarks/badges/performance-badge.json[JWT Performance Score,link=https://cuioss.github.io/cui-jwt/benchmarks/]
image:https://img.shields.io/endpoint?url=https://cuioss.github.io/cui-jwt/benchmarks/validator-badge.json[Access Token Validation,link=https://cuioss.github.io/cui-jwt/benchmarks/]

_Access Token Validation shows average time to validate a single JWT token_

https://cuioss.github.io/cui-jwt/about.html[Generated Documentation on github-pages]

== What is it?

A comprehensive library for validating JWT tokens in multi-issuer environments.
The core idea is to leverage offline-validation of JWT tokens.

Current version: 1.0.0-SNAPSHOT

Key features include:

* Multi-issuer support for handling tokens from different identity providers
* Automatic JWKS (JSON Web Key Set) key management and rotation, with JWKS URI configurable directly or via OpenID Connect (OIDC) Discovery.
* Type-safe token parsing and validation
* Scope-based authorization support
* Protection against common JWT attacks
* Configurable security settings
* Tested compatibility with Keycloak as identity provider

[NOTE]
====
This library is not meant as a replacement for a full-fledged OAuth2 or OpenID Connect library.
Therefore it will never be capable of creating tokens itself.
====

=== Why another JWT-Library?

This project started as an instrumentation of smallrye-jwt, then shifted to jjwt with the goal to implement robust multi-issuer handling. With a strong focus on security (see link:doc/Requirements.adoc[Requirements]), the project evolved through several iterations until it became an entirely new library with its own implementation. The main differentiator is the comprehensive approach to security in multi-issuer environments.

=== Maven Coordinates

[source,xml]
----
    <dependency>
        <groupId>de.cuioss.jwt</groupId>
        <artifactId>cui-jwt-validation</artifactId>
    </dependency>
----

==== Runtime Dependencies

This library requires an implementation of the `jakarta.json-api` to be present at runtime.
The library itself includes the API as a provided dependency, but you need to provide an implementation such as Eclipse Parsson:

[source,xml]
----
    <dependency>
        <groupId>org.eclipse.parsson</groupId>
        <artifactId>parsson</artifactId>
        <version>1.1.7</version> <!-- Use appropriate version -->
    </dependency>
----

Alternatively, you can use any other Jakarta JSON API implementation.

==== Test Artifact

The library also provides a test artifact with utilities for testing JWT validation in your applications:

[source,xml]
----
    <dependency>
        <groupId>de.cuioss.jwt</groupId>
        <artifactId>cui-jwt-validation</artifactId>
        <classifier>generators</classifier>
        <scope>test</scope>
    </dependency>
----

This artifact contains utility classes for creating and manipulating JWT tokens for testing purposes.
See the link:cui-jwt-validation/UnitTesting.adoc[Test Utilities Documentation] for more details.

== Architecture Overview

image::doc/plantuml/component-overview.png[Component Overview]

The library is designed around a pipeline architecture for token validation, with each component handling a specific aspect of the validation process. The main components are:

* *TokenValidator*: The primary entry point for all token operations
* *Token Validation Pipeline*: A series of validators for headers, signatures, and claims
* *Multi-Issuer Support*: Configuration for multiple identity providers
* *Key Management*: Handling of cryptographic keys for token validation, including discovery of JWKS URI via OIDC.

For detailed information about the architecture and components, see the link:doc/specification/technical-components.adoc[Technical Components] documentation.
The library also supports configuration of JWKS URI via link:doc/specification/well-known.adoc[OpenID Connect Discovery], simplifying setup in compatible environments.

== Getting Started

To start using the library, you'll need to:

1. Add the Maven dependency to your project
2. Configure one or more issuers
3. Create a TokenValidator instance
4. Use the validator to validate tokens

Here's a minimal example:

[source,java]
----
// Create issuer configuration
IssuerConfig issuerConfig = IssuerConfig.builder()
        .issuer("https://your-issuer.com")
        .httpJwksLoaderConfig(httpJwksLoaderConfig)
        .build();

// Create validator
TokenValidator validator = new TokenValidator(issuerConfig);

// Validate token
// This will throw TokenValidationException if validation fails
AccessTokenContent accessToken = validator.createAccessToken(tokenString);

// For configuration using OIDC Discovery, see the Usage Guide.
----

For more detailed examples and best practices, see the link:cui-jwt-validation/README.adoc[Usage Guide].

== Documentation

The project includes comprehensive documentation to help you get started and understand the library's capabilities:

* link:cui-jwt-validation/README.adoc[Usage Guide] - How to use the library with code examples
* link:doc/Requirements.adoc[Requirements] - Functional and non-functional requirements
* link:doc/specification/technical-components.adoc[Technical Components] - Detailed component specifications
* link:doc/specification/well-known.adoc[OIDC Discovery Support] - Specification for OIDC .well-known endpoint interaction
* link:doc/security/security-specifications.adoc[Security Specifications] - Security standards and requirements
* link:doc/security/Threat-Model.adoc[Threat Model] - Security analysis and mitigations
* link:doc/LogMessages.adoc[Log Messages] - Logging and troubleshooting
* link:doc/Build.adoc[Building and Development] - Information for contributors
* link:cui-jwt-validation/UnitTesting.adoc[Test Utilities] - Documentation for the test artifact and utilities

== Additional Modules

The project includes several additional modules that extend the core JWT validation functionality:

=== Quarkus Integration

The link:cui-jwt-quarkus-parent/README.adoc[Quarkus Extension] provides seamless integration of the JWT validation library into Quarkus applications. It includes:

* CDI producers for easy dependency injection
* Configuration support via Quarkus properties
* Metrics integration with Micrometer for monitoring JWT validation events
* Health checks for validation components
* Native image support for GraalVM compilation

[source,xml]
----
<dependency>
    <groupId>de.cuioss.jwt</groupId>
    <artifactId>cui-jwt-quarkus</artifactId>
</dependency>
----

=== Performance Benchmarking

The link:cui-jwt-benchmarking/README.adoc[Benchmarking Module] provides comprehensive performance measurements using JMH (Java Microbenchmark Harness). It measures:

* Token validation performance across different scenarios
* JWKS key retrieval and caching performance
* Multi-issuer validation performance
* Concurrent validation capabilities
* Error handling performance impact

Benchmark results are automatically published to GitHub Pages and can be used to track performance regressions over time.

== Next Steps

* Read the link:cui-jwt-validation/README.adoc[Usage Guide] for detailed examples
* Review the link:doc/Requirements.adoc[Requirements] to understand the library's capabilities
* Explore the link:doc/specification/technical-components.adoc[Technical Components] for implementation details
