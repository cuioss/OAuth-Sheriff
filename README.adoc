= cui-jwt-validation

== Status

image:https://github.com/cuioss/cui-jwt-validation/actions/workflows/maven.yml/badge.svg[Java CI with Maven,link=https://github.com/cuioss/cui-jwt-validation/actions/workflows/maven.yml]
image:http://img.shields.io/:license-apache-blue.svg[License,link=http://www.apache.org/licenses/LICENSE-2.0.html]
image:https://maven-badges.herokuapp.com/maven-central/de.cuioss/cui-jwt-validation/badge.svg[Maven Central,link=https://maven-badges.herokuapp.com/maven-central/de.cuioss/cui-jwt-validation]

https://sonarcloud.io/summary/new_code?id=cuioss_cui-jwt-validation[image:https://sonarcloud.io/api/project_badges/measure?project=cuioss_cui-jwt-validation&metric=alert_status[Quality
Gate Status]]
image:https://sonarcloud.io/api/project_badges/measure?project=cuioss_cui-jwt-validation&metric=ncloc[Lines of Code,link=https://sonarcloud.io/summary/new_code?id=cuioss_cui-jwt-validation]
image:https://sonarcloud.io/api/project_badges/measure?project=cuioss_cui-jwt-validation&metric=coverage[Coverage,link=https://sonarcloud.io/summary/new_code?id=cuioss_cui-jwt-validation]

https://cuioss.github.io/cui-jwt-validation/about.html[Generated Documentation on github-pages]

== What is it?

A comprehensive library for validating JWT tokens in multi-issuer environments.
The core idea is to leverage offline-validation of JWT tokens.

The module provides robust token parsing and validation capabilities with a focus on security and ease of use.

Key features include:

* Multi-issuer support for handling tokens from different identity providers
* Automatic JWKS (JSON Web Key Set) key management and rotation
* Type-safe token parsing and validation
* Scope-based authorization support
* Protection against common JWT attacks
* Configurable security settings
* Tested compatibility with Keycloak as identity provider

[NOTE]
====
This library is not meant as a replacement for a full-fledged OAuth2 or OpenID Connect library.
Therefore it will never be capable of creating tokens itself.
====

=== Maven Coordinates

[source,xml]
----
    <dependency>
        <groupId>de.cuioss</groupId>
        <artifactId>cui-jwt-validation</artifactId>
    </dependency>
----

==== Runtime Dependencies

This library requires an implementation of the `jakarta.json-api` to be present at runtime.
The library itself includes the API as a provided dependency, but you need to provide an implementation such as Eclipse Parsson:

[source,xml]
----
    <dependency>
        <groupId>org.eclipse.parsson</groupId>
        <artifactId>parsson</artifactId>
        <version>1.1.1</version> <!-- Use appropriate version -->
    </dependency>
----

Alternatively, you can use any other Jakarta JSON API implementation.

== Core Components

image::doc/plantuml/component-overview.png[Component Overview]

=== TokenValidator: The Main Entry Point

The `TokenValidator` serves as the primary entry point for token operations.
It provides:

* Centralized token creation and validation
* Support for multiple token types (Access, ID, Refresh)
* Pipeline-based token validation
* Support for multiple issuers

For detailed usage examples, see the link:doc/Usage.adoc[Usage Guide].

=== Token Validation Pipeline

The module uses a pipeline approach for token validation:

* `TokenHeaderValidator`: Validates token headers (algorithm, issuer)
* `TokenSignatureValidator`: Validates token signatures using JWKS
* `TokenBuilder`: Creates token content objects
* `TokenClaimValidator`: Validates token claims (expiration, audience, etc.)

=== Multi-Issuer Support

The module provides robust support for multi-issuer environments with configuration of multiple issuers, automatic issuer detection, and thread-safe token validation.

For detailed information about multi-issuer support and key management, see the link:doc/specification/technical-components.adoc#_issuerconfig_and_multi_issuer_support[Multi-Issuer Support] section in the technical components specification.

For detailed examples of multi-issuer configuration, see the link:doc/Usage.adoc[Usage Guide].

=== Custom Claim Mappers

The module supports custom claim mappers that take precedence over the default ones:

* Configure custom ClaimMapper instances for specific claims
* Handle non-standard claims like "role" from specific identity providers
* Extend the system with custom claim mapping logic

For examples of custom claim mapper configuration, see the link:doc/Usage.adoc[Usage Guide].

== Token Architecture and Types

The module uses a flexible architecture based on inheritance and composition, supporting three token types: AccessTokenContent, IdTokenContent, and RefreshTokenContent.

For detailed information about token architecture and types, see the link:doc/specification/technical-components.adoc#_token_architecture_and_types[Token Architecture and Types] section in the technical components specification.

== Documentation

The project includes comprehensive documentation across several categories:

* *Requirements and Specifications*: link:doc/Requirements.adoc[Requirements], link:doc/Specification.adoc[Technical Specification]
* *Security*: link:doc/Threat-Model.adoc[Threat Model], link:doc/specification/security.adoc[Security Specification]
* *Technical Details*: link:doc/specification/technical-components.adoc[Technical Components], link:doc/specification/token-size-validation.adoc[Token Size Validation], link:doc/specification/token-decryption.adoc[Token Decryption]
* *Development*: link:doc/specification/testing.adoc[Testing], link:doc/LogMessages.adoc[Log Messages], link:doc/Usage.adoc[Usage Guide], link:doc/Build.adoc[Building and Development]

== Security Considerations

=== Security Features

* All token validation is performed using cryptographic signatures via Bouncy Castle (bcprov-jdk18on)
* Automatic key rotation prevents stale key usage
* Token size limits prevent memory exhaustion attacks
* Safe Base64 decoding practices
* TLS support for secure key retrieval
* Protection against client confusion attacks
* Comprehensive threat model with STRIDE analysis

=== TokenValidatorConfig Security Settings

The `TokenValidatorConfig` class provides important security settings for token processing to prevent various attacks:

* `maxTokenSize`: Prevents memory exhaustion attacks from oversized tokens
* `maxPayloadSize`: Prevents memory exhaustion attacks from oversized payloads
* `maxStringSize`, `maxArraySize`, `maxDepth`: Prevent JSON parsing attacks

For examples of security settings configuration, see the link:doc/Usage.adoc[Usage Guide].

For more details on security considerations, see the link:doc/Threat-Model.adoc[Threat Model] and link:doc/specification/security.adoc[Security Specification].

== Best Practices

For detailed best practices, including general recommendations, security recommendations, and performance recommendations, see the link:doc/Usage.adoc[Usage Guide].

== Building and Development

For information about building and developing the library, including PlantUML diagram generation and usage, see the link:doc/Build.adoc[Building and Development Guide].
