= Benchmark Results Structure

== Overview

This document explains the expected output structure when running JMH benchmarks with the Maven profiles.

== Maven Profiles

=== `benchmark-testing` Profile

Runs standard performance benchmarks without profiling.

*Command:* `mvn clean install -Pbenchmark-testing`

*Expected Results Location:* `target/benchmark-results/`
- `integration-benchmark-result.json` - JMH benchmark results
- `integration-metrics.json` - Application metrics (created when benchmarks complete successfully)
- `metrics-*.json` - Timestamped metrics files per benchmark

=== `benchmark-jfr` Profile

Runs benchmarks with Java Flight Recorder profiling enabled.

*Command:* `mvn clean install -Pbenchmark-jfr`

*Expected Results Location:* `target/benchmark-jfr-results/`
- `integration-benchmark-result.json` - JMH benchmark results
- `integration-metrics.json` - Application metrics (created when benchmarks complete successfully)
- `metrics-*.json` - Timestamped metrics files per benchmark
- `jfr-recordings/` - Directory containing JFR files copied from container (if container has JFR enabled)

== Important Notes

=== Metrics Export

The `integration-metrics.json` file is only created when:
1. The benchmark runs successfully (at least one iteration completes)
2. The teardown phase is executed
3. Prometheus endpoint is accessible for metrics collection

If benchmarks fail due to connection issues, the metrics files will not be created.

=== JFR Files

JFR files are only available when:
1. Using the `benchmark-jfr` profile
2. The integration test container is running with JFR enabled (using the JFR Dockerfile variant)
3. The container name matches the expected pattern in the profile

=== Empty Result Files

An empty JSON array `[]` in `integration-benchmark-result.json` indicates:
- Benchmarks started but failed before completing any iterations
- Typically due to connection issues with the target services

== Troubleshooting

=== Services Not Available

Ensure the integration test services are running:

[source,bash]
----
cd ../cui-jwt-quarkus-integration-tests
docker compose up -d
----

=== Wrong Container Names

The JFR profile expects specific container names. Check actual names with:

[source,bash]
----
docker ps --format "table {{.Names}}"
----

=== Missing Metrics

If `integration-metrics.json` is missing:
- Check that Prometheus is accessible at the configured URL
- Verify at least one benchmark iteration completed successfully
- Check logs for metric export errors