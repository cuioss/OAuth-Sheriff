= Review Doc Findings
:toc:
:toclevels: 3
:toc-title: Table of Contents
:sectnums:

This document records findings from the documentation review and suggests actionable tasks to address them.

== DOC - Documentation Improvements

// Findings will be added here following the format:
// === DOC[Number]. [Task Title]
// [ ] *Priority:* [High/Medium/Low]
//
// *Description:* [Detailed description of the finding]
//
// *Rationale:* [Explanation of why this finding is important to address]

=== DOC1. Review Requirements.adoc References
[ ] *Priority:* Medium

*Description:* Several RFCs and external documents are referenced in `doc/Requirements.adoc`. These links should be verified to ensure they point to the latest and most relevant versions of the documents. For example, `draft-ietf-oauth-jwt-bcp-09` is referenced; check if it has been finalized or superseded.

*Rationale:* Outdated references can lead to implementing against obsolete standards, potentially introducing security vulnerabilities or compatibility issues. Keeping references current is crucial for a security-focused library.

=== DOC2. Clarify "Future Version" for JWE Requirement
[ ] *Priority:* Low

*Description:* Requirement `CUI-JWT-1.4: Token Decryption (Optional - Future Version)` states JWE support is for a "future version". This is vague. If there's a roadmap or planned version for this, it should be mentioned. If not, it should be clarified that it's a potential future enhancement without a specific timeline.

*Rationale:* Clear communication about feature availability manages expectations and helps users and contributors understand the library's current capabilities and future direction. The `general-standard.adoc` states "Only document existing code elements - no speculative or planned features" unless clearly marked. While it is marked, adding more clarity would be beneficial.

=== DOC3. Verify Terminology Consistency in Requirements.adoc
[ ] *Priority:* Medium

*Description:* Review `doc/Requirements.adoc` for consistent use of terminology as per the project's glossary (if one exists) and general industry standards (e.g., RFCs). Pay attention to terms like "Token Types", "Signature Algorithms", etc.

*Rationale:* Consistent terminology improves readability and understanding, reducing ambiguity, which is vital for security requirements. This aligns with the `general-standard.adoc` principle of using consistent terminology.

=== DOC4. Image in Requirements.adoc
[ ] *Priority:* Low

*Description:* The document `doc/Requirements.adoc` includes an image `image::plantuml/token-structure.png[JWT Token Structure]` under section `CUI-JWT-1.1`. The `general-standard.adoc` does not explicitly mention standards for images. However, ensure the image is generated from a source file (like a .puml file) that is version controlled, and that the image is clear and up-to-date.

*Rationale:* Images should be maintainable and accurate. If the source `token-structure.puml` exists and is up-to-date, this is good. If the image is static and its source is unclear, it could become outdated.

=== DOC5. Requirements Numbering Gap
[ ] *Priority:* Low

*Description:* In `doc/Requirements.adoc`, the functional requirements jump from `CUI-JWT-8.5` to `CUI-JWT-12`. Requirements `CUI-JWT-9`, `CUI-JWT-10`, `CUI-JWT-11` seem to be missing or were renumbered. This should be investigated and corrected if it's an error, or explained if intentional. The non-functional requirements start with `CUI-JWT-9` again. This dual use of numbers should be rectified.

*Rationale:* Consistent and sequential numbering is important for clarity, traceability, and referencing requirements. Gaps or duplicate numbering can cause confusion.

=== DOC6. Verify Links in Specification.adoc
[ ] *Priority:* High

*Description:* `doc/Specification.adoc` contains numerous internal links to sub-specification documents (e.g., `specification/technical-components.adoc`, `specification/security.adoc`) and to `Requirements.adoc`. All these links must be verified to ensure they are not broken and point to the intended targets. For example, check if `link:specification/token-decryption.adoc[Token Decryption]` correctly reflects its status (future implementation).

*Rationale:* Broken or incorrect links severely hinder navigation and understanding of the documentation, making it difficult for users and developers to find information. This is critical for compliance with `general-standard.adoc` ("All references must be verified to exist").

=== DOC7. Consistency of "Token Decryption" Specification
[ ] *Priority:* Medium

*Description:* `doc/Specification.adoc` links to `specification/token-decryption.adoc` and mentions it as "future implementation" in the "Implementation Details" section. This is consistent with `Requirements.adoc#CUI-JWT-1.4`. The content of `specification/token-decryption.adoc` itself needs to be reviewed (in a later step) to ensure it clearly states its future status and avoids presenting speculative features as current.

*Rationale:* Ensures that documentation about future features is clearly demarcated and does not mislead readers about current library capabilities, aligning with `general-standard.adoc`.

=== DOC8. Specification.adoc Component Overview Diagram
[ ] *Priority:* Low

*Description:* `doc/Specification.adoc` includes an image `image::plantuml/component-overview.png[Component Overview]`. Verify that this image is generated from a version-controlled PlantUML source file (presumably `doc/plantuml/component-overview.puml`) and that the diagram accurately reflects the current architecture described in `specification/technical-components.adoc`.

*Rationale:* Architectural diagrams must be accurate and maintainable. Using a source file allows for easier updates and version control, ensuring the diagram doesn't become outdated.

=== DOC9. Specification.adoc Completeness of Component Descriptions
[ ] *Priority:* Medium

*Description:* The "Component Descriptions" section in `doc/Specification.adoc` provides a brief overview of components like `TokenValidator`, `ParserConfig`, etc., and links to `specification/technical-components.adoc` for details. This is good. The review of `specification/technical-components.adoc` (later step) will need to confirm that all components mentioned here are indeed detailed there and that no major components are missing from this overview.

*Rationale:* The main specification document should provide a complete high-level overview, and its references to detailed documents must be accurate and comprehensive.

=== DOC10. Cross-References to Requirements in Specification.adoc
[ ] *Priority:* Medium

*Description:* `doc/Specification.adoc` includes references like "_See Requirement link:Requirements.adoc#CUI-JWT-1[CUI-JWT-1: Token Parsing and Validation]_". These cross-references should be checked for accuracy: do they point to the most relevant requirement, and are the requirement IDs correct?

*Rationale:* Accurate cross-referencing between specification and requirements is crucial for traceability and understanding how the technical design fulfills the mandated needs.

=== DOC11. Review Navigation Links in jwks-size-recommendations.adoc
[ ] *Priority:* Low

*Description:* The document `doc/specification/jwks-size-recommendations.adoc` includes an extensive "Document Navigation" section. While helpful, these links need verification for correctness and relevance. Some links like "Token Decryption" point to future features and should be consistent in their presentation. Also, ensure this navigation structure is consistent with other sub-specification documents.

*Rationale:* Accurate navigation links are essential for user experience. Consistency in navigation across related documents improves overall documentation usability.

=== DOC12. Verify Requirement Links in jwks-size-recommendations.adoc
[ ] *Priority:* Medium

*Description:* The document `doc/specification/jwks-size-recommendations.adoc` references `link:../Requirements.adoc#CUI-JWT-8.1[CUI-JWT-8.1: Token Size Limits]` and `link:../Requirements.adoc#CUI-JWT-8.2[CUI-JWT-8.2: Safe Parsing]`. These links and the relevance of these specific requirements to JWKS content size (as opposed to JWT token size) should be verified. Requirement CUI-JWT-8.1 is about *token* size limits. While related, the link's relevance to *JWKS* size should be very clear or a more specific requirement should be referenced/created.

*Rationale:* Ensuring that references to requirements are accurate and highly relevant is key for traceability and justifying design decisions. Misleading links can cause confusion.

=== DOC13. Data Source for IdP JWKS Sizes
[ ] *Priority:* Medium

*Description:* The section "Major Identity Providers" in `doc/specification/jwks-size-recommendations.adoc` lists typical JWKS sizes for providers like Auth0, Okta, etc. It would be beneficial to state the date or method of this analysis (e.g., "Analysis performed in Q4 2023 by checking public .well-known configurations").

*Rationale:* Data about external services can become outdated. Indicating the freshness or source of this data helps readers assess its current relevance, aligning with the principle of providing accurate and verifiable information.

=== DOC14. Verify Links to Code and Tests in security.adoc
[ ] *Priority:* High

*Description:* `doc/specification/security.adoc` contains numerous links to `.java` source files and test files (e.g., `link:../../src/main/java/de/cuioss/jwt/validation/pipeline/TokenSignatureValidator.java[TokenSignatureValidator]`). Each of these links must be meticulously verified to ensure they point to the correct file and that the linked code/test is indeed the primary implementation or verification for the described security measure. Also, check for broken links.

*Rationale:* Accurate links to code are essential for developers to understand the implementation details of security measures. Broken or incorrect links can lead to misunderstandings and make it difficult to audit or maintain the code. This is a critical aspect of the "All references must be verified to exist" principle from `general-standard.adoc`.

=== DOC15. Consistency of Supported/Rejected Algorithms in security.adoc
[ ] *Priority:* High

*Description:* The "Supported Algorithms" and "Rejected Algorithms" lists in `doc/specification/security.adoc` under "Signature Validation" must be cross-verified with the lists and rationale provided in `doc/Requirements.adoc#CUI-JWT-1.3`. Ensure perfect consistency in algorithm names and the reasons for rejection.

*Rationale:* Inconsistencies in supported cryptographic algorithms between requirements and specification can lead to incorrect implementations or misunderstandings of the library's security posture.

=== DOC16. Status of "Scope Upgrade Attack Prevention" in security.adoc
[ ] *Priority:* Medium

*Description:* In `doc/specification/security.adoc`, the "Scope Upgrade Attack Prevention" section states "Status: IMPLEMENTED". However, it also says, "Scope validation is implemented at the application level, not as part of the token validation process" and "The final check whether the scopes are correct are to be in the client library." This seems to imply the core library doesn't fully prevent it, but rather provides tools for the application to do so. The "IMPLEMENTED" status might be misleading if the library itself doesn't enforce this. Clarify the library's direct role vs. application responsibility.

*Rationale:* The implementation status must accurately reflect the library's capabilities. If the prevention is largely an application concern using library-provided tools, this should be stated more clearly to avoid misrepresenting the library's security guarantees.

=== DOC17. Code Example Source in security.adoc
[ ] *Priority:* Medium

*Description:* The `doc/specification/security.adoc` document includes a Java code example for configuring `IssuerConfig` for "Client Confusion Attack Prevention". According to `doc/library/standards/documentation/general-standard.adoc`, "Code examples must come from actual unit tests". Verify if this example is from a unit test or can be easily verified. If not, consider linking to a test that demonstrates this configuration.

*Rationale:* Code examples sourced from unit tests are more likely to be correct, maintained, and executable, providing higher quality documentation.

=== DOC18. "Additional OAuth/JWT Security Considerations" Source Date
[ ] *Priority:* Low

*Description:* The section "Additional OAuth/JWT Security Considerations" in `doc/specification/security.adoc` references `https://blog.doyensec.com/2025/01/30/oauth-common-vulnerabilities.html[OAuth Common Vulnerabilities (Doyensec, 2025)]`. The year "2025" seems to be a typo and should be verified. Assuming it's a real article, check if it's the most current or relevant source for these considerations.

*Rationale:* Referencing up-to-date and accurate external resources is important, especially for rapidly evolving security topics. A typo in the year is a minor but noticeable issue.

=== DOC19. Completeness of Security Testing Specifications Table
[ ] *Priority:* Medium

*Description:* In `doc/specification/security.adoc`, under "Security Testing Specifications" > "Client Confusion Attack Testing", the table lists test cases. One test case, "verify_audience_validation_failure", is marked as "Not implemented yet" in the "Implementation" column. This status should be verified. If it's indeed not implemented, the overall "Status: IMPLEMENTED" for "Client Confusion Attack Prevention" might need qualification.

*Rationale:* The documentation should accurately reflect the current state of implementation, including test coverage for security features. Discrepancies can be misleading.

=== DOC20. Verify Links and Content in technical-components.adoc
[ ] *Priority:* High

*Description:* `doc/specification/technical-components.adoc` is a cornerstone document with numerous links to source code (`.java` files), test files, other specification documents, and requirements. Each link must be meticulously verified for correctness (points to the right place, not broken) and relevance (the linked content accurately reflects the description). The textual description of each component (e.g., `TokenValidator`, `JwksLoader`, `SecurityEventCounter`) must be checked against its actual implementation in the linked source code for accuracy and completeness. Confirm "Status: IMPLEMENTED" for all sections.

*Rationale:* This document bridges the gap between high-level design and actual code. Accuracy here is paramount for developers to understand the system. Incorrect or outdated information can lead to significant misunderstandings, wasted effort, and bugs. This directly supports multiple principles in `general-standard.adoc`, including "All references must be verified to exist" and "Only document existing code elements".

=== DOC21. PlantUML Diagrams in technical-components.adoc
[ ] *Priority:* Medium

*Description:* `doc/specification/technical-components.adoc` includes several PlantUML diagrams: `multi-issuer-support.png`, `key-management.png`, and `token-types.png`. For each diagram:
    1. Verify the image link is correct (e.g., `image::../../doc/plantuml/multi-issuer-support.png[...]`). Note the `../../doc` path, which seems to try to exit `doc/specification/` and re-enter `doc/`. This might be incorrect; typical relative paths would be `../plantuml/...puml`.
    2. Confirm that a corresponding `.puml` source file exists in `doc/plantuml/`.
    3. Assess if the diagram accurately represents the described components and their interactions as detailed in this document and potentially in the linked source code.

*Rationale:* Diagrams are powerful tools for understanding architecture, but only if they are accurate and sourced from maintainable, version-controlled files. Incorrect paths or outdated diagrams reduce their value and can be misleading.

=== DOC22. RefreshTokenContent Caution in technical-components.adoc
[ ] *Priority:* Medium

*Description:* Under "Token Architecture and Types" in `doc/specification/technical-components.adoc`, the description for `RefreshTokenContent` includes: "*Caution:* The signature of the refresh token is not verified, so the claims should be treated as untrusted." This is an important security note.
    1. Verify this behavior (non-verification of refresh token signature) is intentional and documented in requirements or security policies if applicable.
    2. Ensure this caution is prominent and perhaps also mentioned in `security.adoc` if it has security implications that users must be aware of.

*Rationale:* Security-relevant details, especially caveats about trust, must be clearly and prominently communicated. If refresh token claims are populated but untrusted, developers must understand this to avoid potential vulnerabilities.

=== DOC23. Dependency Management Section in technical-components.adoc
[ ] *Priority:* Low

*Description:* The "Dependency Management" section in `doc/specification/technical-components.adoc` describes the use of GitHub Dependabot. It links to `Requirements.adoc#CUI-JWT-8`. Requirement CUI-JWT-8 is "Security". While dependency management is crucial for security, it's a process/tooling aspect. Consider if this section belongs more appropriately in `Build.adoc` or a general development practices document, rather than in `technical-components.adoc` which focuses on the library's software components. Alternatively, ensure the link to CUI-JWT-8 is justified by explaining how this specific requirement mandates automated dependency checking.

*Rationale:* Ensuring information is in the most logical location improves document organization and discoverability. Technical components usually refer to the software's building blocks, not development processes.

=== DOC24. Consistency of Component Coverage with Specification.adoc
[ ] *Priority:* Medium

*Description:* Cross-reference the list of components detailed in `doc/specification/technical-components.adoc` with the components listed in the overview section of `doc/Specification.adoc` ("Component Descriptions"). Ensure:
    1. All components mentioned in the main specification's overview have a detailed section here.
    2. All major components detailed here are at least mentioned in the main specification's overview.
    3. The brief descriptions in `Specification.adoc` are consistent with the detailed descriptions in `technical-components.adoc`.

*Rationale:* Consistency between the overview specification and the detailed technical component specification is important for a coherent understanding of the system architecture.

=== DOC25. Verify Links and Status in testing.adoc
[ ] *Priority:* High

*Description:* `doc/specification/testing.adoc` is rich with links to test classes (`*Test.java`, `*IT.java`), utility classes (`JwtTokenTamperingUtil.java`, generator classes), requirement documents, and external CUI testing standards. Each link must be verified for correctness (points to the right target, not broken) and relevance. The "Status: IMPLEMENTED" claim for each testing category (Unit, Integration, Security, Performance, Logging, Vulnerability Scanning, Fuzz, Compliance) must be validated by checking the linked test code and ensuring comprehensive coverage as described. For instance, under "Unit Testing", a list of "Test Cases" is provided (e.g., "Token Parsing Tests", "Key Management Tests"); verify these are indeed covered by the linked test classes.

*Rationale:* Accurate documentation of testing is vital for quality assurance, maintainability, and demonstrating compliance with requirements. Broken links or incorrect status claims undermine confidence in the testing strategy. This directly relates to "All references must be verified to exist" and "Only document existing code elements (or features)" from `general-standard.adoc`.

=== DOC26. External CUI Testing Standards Links
[ ] *Priority:* Medium

*Description:* `doc/specification/testing.adoc` references CUI Testing Standards via GitHub links (e.g., `https://github.com/cuioss/cui-llm-rules/blob/main/standards/testing/core-standards.adoc`).
    1. Verify these links are active and point to the correct documents.
    2. Assess if the summaries provided in `testing.adoc` accurately reflect the content of these external standards.
    3. Consider whether it's preferable to have copies of these standards within this project's `doc/library/standards/testing/` directory for version consistency and offline access, rather than relying solely on external URLs that might change or become unavailable.

*Rationale:* While linking to external standards is common, ensuring their accessibility and the accuracy of their summaries is important. For foundational standards, embedding or vendoring them can increase the self-contained nature of the project documentation.

=== DOC27. Clarity of "Vulnerability Scanning" Implementation
[ ] *Priority:* Medium

*Description:* In `doc/specification/testing.adoc`, the "Vulnerability Scanning" section states "Status: IMPLEMENTED" and refers to GitHub Dependabot. It then links to `security.adoc` for "detailed information about dependency management and vulnerability scanning". However, `security.adoc`'s "Dependency Management" section (as per DOC23 finding on `technical-components.adoc` which seems to have this section instead) primarily describes Dependabot for *dependency updates*. Clarify if Dependabot is used for *active vulnerability scanning* of the project's own code or if it's mainly for third-party library vulnerabilities. The "Fuzz Testing Implementation" is also under this section, which feels misplaced if "Vulnerability Scanning" is only about dependencies.

*Rationale:* The scope and nature of "Vulnerability Scanning" need to be precise. Fuzz testing is a code testing technique, not typically categorized under dependency scanning. Clear distinctions improve understanding of the actual security measures in place.

=== DOC28. Code Examples in testing.adoc
[ ] *Priority:* Low

*Description:* `doc/specification/testing.adoc` includes Java code snippets for parameterized tests using `@TypeGeneratorSource` and for `JwtTokenTamperingUtil`. As per `general-standard.adoc` ("Code examples must come from actual unit tests"), verify these snippets are concise, illustrative, and directly reflect patterns used in the actual linked test files. Avoid large, duplicated code blocks if a link to the source test can convey the same information.

*Rationale:* Code examples should be accurate and maintainable. Linking to tests is often better than embedding large snippets. The examples here seem reasonable but should be checked for conciseness and relevance to the actual test code.

=== DOC29. Test Class Naming Convention and Requirement Referencing
[ ] *Priority:* Low

*Description:* The "Compliance Testing" section in `doc/specification/testing.adoc` describes a "Test Class Naming Convention" (`<Standard><Feature>ComplianceTest`) and "Requirement Referencing" practices within tests. Verify if the linked compliance test classes (e.g., `RFC7519JWTComplianceTest.java`) actually follow this naming convention and if the described requirement referencing (class/method level JavaDocs, assertion messages) is consistently applied in practice.

*Rationale:* Documented conventions are only useful if followed. Verifying adherence helps ensure the documentation accurately reflects practice, aiding maintainability and traceability.
